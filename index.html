<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Vietnam & Thailand Adventure Planner</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" integrity="sha256-p4NxAoJBhIIN+hmNHrzRCf9tD/miZyoHS5obTRR9BMY=" crossorigin=""/>
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js" integrity="sha256-20nQCchB9co0qIjJZRGuk2/Z9VM+kNiyxNV1lvTlZBo=" crossorigin=""></script>
    <style>
        body { font-family: 'Inter', sans-serif; }
        .leaflet-popup-content-wrapper { border-radius: 8px; }
        .leaflet-popup-content { margin: 14px 20px; font-size: 14px; line-height: 1.4; }
        .leaflet-popup-content h3 { margin: 0 0 5px; font-weight: bold; }
        .leaflet-container { font-family: 'Inter', sans-serif; }
        .highlight { background-color: #fef9c3; border-left: 4px solid #f59e0b; }
    </style>
    <!-- Chosen Palette: "Tropical Serenity" - A mix of calming sea blues, lush jungle greens, and warm sandy beige. -->
    <!-- Application Structure Plan: A responsive, two-panel layout. On the left (or top on mobile), a dynamic itinerary allows users to view and edit daily plans. On the right (or bottom), an interactive Leaflet map visualizes the journey. This dual-view provides immediate geographic context to the schedule. Clicking an itinerary item pans the map to the location, and clicking a map marker highlights the corresponding itinerary days. This interconnected design makes planning intuitive and engaging. The ability to edit details directly addresses the user's request for a flexible tool. -->
    <!-- Visualization & Content Choices: The core visualization is a Leaflet.js map, chosen for its performance and ease of use. It displays locations as markers. The itinerary is a structured HTML list, dynamically generated from a JavaScript data object. This data-driven approach allows for easy updates when the user edits an entry. The interaction model is simple: click-to-focus. This avoids complexity while providing a powerful way to connect the schedule with the geography. -->
    <!-- CONFIRMATION: NO SVG graphics used. NO Mermaid JS used. -->
</head>
<body class="bg-gray-50 text-gray-800">

    <div class="container mx-auto p-4 md:p-6">
        <header class="text-center mb-6">
            <h1 class="text-4xl md:text-5xl font-bold text-gray-800">Vietnam & Thailand Adventure</h1>
            <p class="text-lg text-gray-600 mt-2">August 20 - September 18</p>
        </header>

        <div class="flex flex-col md:flex-row gap-6">
            <!-- Itinerary Panel -->
            <div id="itinerary-panel" class="w-full md:w-1/3 bg-white p-4 rounded-lg shadow-lg overflow-y-auto" style="height: 75vh;">
                <h2 class="text-2xl font-bold mb-4 text-gray-700 border-b pb-2">Your Itinerary</h2>
                <div id="itinerary-list" class="space-y-4">
                    <!-- Itinerary items will be injected here by JavaScript -->
                </div>
            </div>

            <!-- Map Panel -->
            <div class="w-full md:w-2/3 h-[50vh] md:h-[75vh] rounded-lg shadow-lg overflow-hidden">
                <div id="map" class="w-full h-full"></div>
            </div>
        </div>
    </div>

    <!-- Add New Item Button -->
    <button id="add-item-btn" class="fixed bottom-6 right-6 bg-blue-600 hover:bg-blue-700 text-white font-bold py-3 px-6 rounded-full shadow-lg z-[9998]">
        + Add New Item
    </button>

    <!-- Modal for Editing/Adding -->
    <div id="edit-modal" class="fixed inset-0 bg-gray-600 bg-opacity-50 overflow-y-auto h-full w-full hidden z-[9999]">
        <div class="relative top-20 mx-auto p-5 border w-11/12 md:w-1/2 shadow-lg rounded-md bg-white">
            <div class="mt-3 text-center">
                <h3 class="text-lg leading-6 font-medium text-gray-900" id="modal-title">Edit Itinerary Item</h3>
                <div class="mt-2 px-7 py-3">
                    <div id="new-item-fields" class="space-y-4 mb-4 hidden">
                        <div class="text-left">
                            <label for="new-day" class="text-sm font-medium text-gray-700">Day (e.g., Aug 20, Sep 1-4):</label>
                            <input type="text" id="new-day" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-300 focus:ring focus:ring-indigo-200 focus:ring-opacity-50 p-2">
                        </div>
                        <div class="text-left">
                            <label for="new-location" class="text-sm font-medium text-gray-700">Location:</label>
                            <input type="text" id="new-location" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-300 focus:ring focus:ring-indigo-200 focus:ring-opacity-50 p-2">
                        </div>
                        <div class="flex gap-4">
                            <div class="text-left w-1/2">
                                <label for="new-latitude" class="text-sm font-medium text-gray-700">Latitude:</label>
                                <input type="number" step="any" id="new-latitude" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-300 focus:ring focus:ring-indigo-200 focus:ring-opacity-50 p-2">
                            </div>
                            <div class="text-left w-1/2">
                                <label for="new-longitude" class="text-sm font-medium text-gray-700">Longitude:</label>
                                <input type="number" step="any" id="new-longitude" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-300 focus:ring focus:ring-indigo-200 focus:ring-opacity-50 p-2">
                            </div>
                        </div>
                    </div>
                    <div class="text-left">
                        <label for="edit-activity" class="text-sm font-medium text-gray-700">Activity/Plan:</label>
                        <textarea id="edit-activity" rows="4" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-300 focus:ring focus:ring-indigo-200 focus:ring-opacity-50 p-2"></textarea>
                    </div>
                    <div class="text-left mt-4">
                        <label for="edit-notes" class="text-sm font-medium text-gray-700">Notes (e.g., Kosher Food, Hotel):</label>
                        <textarea id="edit-notes" rows="3" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-300 focus:ring focus:ring-indigo-200 focus:ring-opacity-50 p-2"></textarea>
                    </div>
                </div>
                <div class="items-center px-4 py-3">
                    <button id="save-button" class="px-4 py-2 bg-blue-500 text-white text-base font-medium rounded-md w-full shadow-sm hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-blue-300">
                        Save Changes
                    </button>
                    <button id="close-modal" class="mt-2 px-4 py-2 bg-gray-200 text-gray-800 text-base font-medium rounded-md w-full shadow-sm hover:bg-gray-300 focus:outline-none focus:ring-2 focus:ring-gray-300">
                        Cancel
                    </button>
                </div>
            </div>
        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', function () {
            const itineraryData = [
                { day: "Aug 20", location: "En Route", coords: [21.0285, 105.8542], activity: "Depart from Israel", notes: "Morning flight at 11:00 AM. Layover in Dubai." },
                { day: "Aug 21", location: "Hanoi", coords: [21.0285, 105.8542], activity: "Arrive in Hanoi", notes: "Land in Hanoi at 13:15. Take taxi to hotel near Chabad House. Settle in and explore the Old Quarter." },
                { day: "Aug 22", location: "Hanoi", coords: [21.0285, 105.8542], activity: "Hanoi Exploration", notes: "Visit Hoan Kiem Lake, Ngoc Son Temple, and Temple of Literature. Water puppet show in the evening." },
                { day: "Aug 23", location: "Hanoi", coords: [21.0285, 105.8542], activity: "Hanoi & Shabbat Prep", notes: "Visit Ho Chi Minh Mausoleum Complex. Prepare for Shabbat. Dinner at Chabad House." },
                { day: "Aug 24", location: "Hanoi", coords: [21.0285, 105.8542], activity: "Shabbat in Hanoi / Train to Sapa", notes: "Shabbat at Chabad House. Board overnight train to Lao Cai (Sapa) in the evening." },
                { day: "Aug 25", location: "Sapa", coords: [22.3365, 103.8439], activity: "Arrival & Exploration in Sapa", notes: "Arrive in Lao Cai, transfer to Sapa. Light trek to Cat Cat village. Rely on pre-packed kosher food." },
                { day: "Aug 26", location: "Sapa", coords: [22.3365, 103.8439], activity: "Sapa Trekking / Train to Hanoi", notes: "Trek to Ta Van or Lao Chai villages. Board overnight train back to Hanoi." },
                { day: "Aug 27", location: "Ha Long Bay", coords: [20.9101, 107.0759], activity: "Day Trip to Ha Long Bay", notes: "Full-day cruise through the limestone karsts. Return to Hanoi for sleep." },
                { day: "Aug 28", location: "Ninh Binh", coords: [20.2528, 105.9738], activity: "Day Trip to Ninh Binh", notes: "Sampan boat ride in Tam Coc/Trang An. Climb Mua Cave viewpoint. Return to Hanoi for sleep." },
                { day: "Aug 29", location: "Hanoi", coords: [21.0285, 105.8542], activity: "Free Day in Hanoi", notes: "Relax, shop for souvenirs, and prepare for the flight to Thailand." },
                { day: "Aug 30", location: "Koh Samui", coords: [9.5357, 99.9357], activity: "Fly to Koh Samui, Thailand", notes: "Fly from Hanoi (HAN) to Koh Samui (USM). Check into hotel near Chabad House for Shabbat." },
                { day: "Aug 31", location: "Koh Samui", coords: [9.5357, 99.9357], activity: "Shabbat in Koh Samui", notes: "Observe Shabbat at Chabad House. Relax on the beach." },
                { day: "Sep 1-4", location: "Koh Samui", coords: [9.5357, 99.9357], activity: "Koh Samui Exploration", notes: "Visit Big Buddha, Wat Plai Laem, Na Muang Waterfalls. Enjoy beaches like Chaweng and Lamai." },
                { day: "Sep 5", location: "Koh Phangan", coords: [9.7354, 100.0136], activity: "Ferry to Koh Phangan", notes: "Check into hotel near Chabad House. Explore the island." },
                { day: "Sep 6", location: "Koh Phangan", coords: [9.7354, 100.0136], activity: "Koh Phangan & Shabbat Prep", notes: "Relax on the beach, prepare for Shabbat. Dinner at Chabad House." },
                { day: "Sep 7", location: "Koh Phangan", coords: [9.7354, 100.0136], activity: "Shabbat in Koh Phangan", notes: "Observe Shabbat at Chabad House." },
                { day: "Sep 8", location: "Koh Tao", coords: [10.0956, 99.8413], activity: "Ferry to Koh Tao", notes: "Check into hotel near Chabad House. Great for diving and snorkeling." },
                { day: "Sep 9", location: "Koh Tao", coords: [10.0956, 99.8413], activity: "Koh Tao Activities", notes: "Diving, snorkeling, or hiking to a viewpoint." },
                { day: "Sep 10", location: "Koh Samui", coords: [9.5357, 99.9357], activity: "Return to Koh Samui & Travel", notes: "Ferry back to Koh Samui. Fly to Bangkok in the afternoon/evening." },
                { day: "Sep 11-13", location: "Bangkok", coords: [13.7563, 100.5018], activity: "Bangkok Exploration", notes: "Visit Grand Palace, Wat Pho, Wat Arun. Explore markets and malls. Many kosher options available." },
                { day: "Sep 13", location: "Bangkok", coords: [13.7563, 100.5018], activity: "Bangkok & Shabbat Prep", notes: "Final sightseeing. Prepare for Shabbat. Dinner at Chabad House." },
                { day: "Sep 14", location: "Bangkok", coords: [13.7563, 100.5018], activity: "Shabbat in Bangkok", notes: "Observe Shabbat at Chabad House." },
                { day: "Sep 15-17", location: "Bangkok", coords: [13.7563, 100.5018], activity: "Bangkok Free Days", notes: "More exploration, day trips, or relaxation before your flight home." },
                { day: "Sep 18", location: "Bangkok", coords: [13.7563, 100.5018], activity: "Departure", notes: "Fly from Bangkok (BKK) back to Israel." }
            ];

            const map = L.map('map').setView([15, 105], 4);
            L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
                attribution: '&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors'
            }).addTo(map);

            const itineraryList = document.getElementById('itinerary-list');
            const modal = document.getElementById('edit-modal');
            const closeModalBtn = document.getElementById('close-modal');
            const saveBtn = document.getElementById('save-button');
            const activityInput = document.getElementById('edit-activity');
            const notesInput = document.getElementById('edit-notes');
            const newDayInput = document.getElementById('new-day');
            const newLocationInput = document.getElementById('new-location');
            const newLatitudeInput = document.getElementById('new-latitude');
            const newLongitudeInput = document.getElementById('new-longitude');
            const newItemFields = document.getElementById('new-item-fields');
            const addItemBtn = document.getElementById('add-item-btn');

            let currentEditIndex = -1; // -1 indicates "add new item" mode

            const markers = {};
            const pathPoints = [];

            function renderItinerary() {
                itineraryList.innerHTML = '';
                itineraryData.forEach((item, index) => {
                    const div = document.createElement('div');
                    div.className = 'relative p-4 border rounded-lg cursor-pointer hover:bg-gray-100 transition-colors duration-200';
                    div.id = `item-${index}`;
                    div.innerHTML = `
                        <div class="flex justify-between items-center">
                            <div>
                                <p class="font-bold text-blue-600">${item.day}: ${item.location}</p>
                                <p class="text-sm text-gray-700 mt-1">${item.activity}</p>
                                <p class="text-xs text-gray-500 mt-1"><em>${item.notes}</em></p>
                            </div>
                            <button data-index="${index}" class="edit-btn text-xs bg-gray-200 hover:bg-gray-300 text-gray-700 font-semibold py-1 px-2 rounded">Edit</button>
                        </div>
                        <span data-index="${index}" class="remove-x absolute top-2 right-2 text-red-500 cursor-pointer font-bold text-lg leading-none">&times;</span>
                    `;
                    itineraryList.appendChild(div);
                });

                document.querySelectorAll('.edit-btn').forEach(button => {
                    button.addEventListener('click', (e) => {
                        e.stopPropagation();
                        openEditModal(parseInt(e.target.dataset.index, 10));
                    });
                });

                document.querySelectorAll('.remove-x').forEach(span => {
                    span.addEventListener('click', (e) => {
                        e.stopPropagation();
                        const indexToRemove = parseInt(e.target.dataset.index, 10);
                        removeItineraryItem(indexToRemove);
                    });
                });

                document.querySelectorAll('#itinerary-list > div').forEach((div, index) => {
                    div.addEventListener('click', () => {
                        const item = itineraryData[index];
                        map.flyTo(item.coords, 8);
                        if (markers[item.location]) {
                            markers[item.location].openPopup();
                        }
                        highlightItineraryItem(index);
                    });
                });
            }

            function openEditModal(index) {
                currentEditIndex = index;
                const item = itineraryData[currentEditIndex];
                document.getElementById('modal-title').innerText = `Edit: ${item.day} - ${item.location}`;
                activityInput.value = item.activity;
                notesInput.value = item.notes;
                newItemFields.classList.add('hidden'); // Hide new item fields for editing
                modal.style.display = 'block';
            }

            function openAddModal() {
                currentEditIndex = -1; // Set to -1 for "add" mode
                document.getElementById('modal-title').innerText = `Add New Itinerary Item`;
                activityInput.value = '';
                notesInput.value = '';
                newDayInput.value = '';
                newLocationInput.value = '';
                newLatitudeInput.value = '';
                newLongitudeInput.value = '';
                newItemFields.classList.remove('hidden'); // Show new item fields for adding
                modal.style.display = 'block';
            }

            function removeItineraryItem(index) {
                const confirmationModal = document.createElement('div');
                confirmationModal.className = 'fixed inset-0 bg-gray-600 bg-opacity-50 flex items-center justify-center z-[10000]';
                confirmationModal.innerHTML = `
                    <div class="bg-white p-6 rounded-lg shadow-xl text-center">
                        <p class="text-lg font-semibold mb-4">Are you sure you want to remove this itinerary item?</p>
                        <div class="flex justify-center space-x-4">
                            <button id="confirm-remove" class="px-4 py-2 bg-red-500 text-white rounded hover:bg-red-600">Yes, Remove</button>
                            <button id="cancel-remove" class="px-4 py-2 bg-gray-300 text-gray-800 rounded hover:bg-gray-400">Cancel</button>
                        </div>
                    </div>
                `;
                document.body.appendChild(confirmationModal);

                document.getElementById('confirm-remove').addEventListener('click', () => {
                    itineraryData.splice(index, 1);
                    renderItinerary();
                    renderMap();
                    document.body.removeChild(confirmationModal);
                });

                document.getElementById('cancel-remove').addEventListener('click', () => {
                    document.body.removeChild(confirmationModal);
                });
            }

            function highlightItineraryItem(index) {
                document.querySelectorAll('#itinerary-list > div').forEach(div => div.classList.remove('highlight'));
                const itemEl = document.getElementById(`item-${index}`);
                if (itemEl) {
                    itemEl.classList.add('highlight');
                    itemEl.scrollIntoView({ behavior: 'smooth', block: 'center' });
                }
            }

            function renderMap() {
                Object.values(markers).forEach(marker => map.removeLayer(marker));
                if (window.polyline) map.removeLayer(window.polyline);

                const uniqueLocations = {};
                itineraryData.forEach((item) => {
                    if (!uniqueLocations[item.location]) {
                        uniqueLocations[item.location] = {
                            coords: item.coords,
                            days: []
                        };
                    }
                    uniqueLocations[item.location].days.push({ day: item.day, activity: item.activity });
                });
                
                for (const loc in uniqueLocations) {
                    const locationData = uniqueLocations[loc];
                    const marker = L.marker(locationData.coords).addTo(map);
                    let popupContent = `<h3>${loc}</h3>`;
                    locationData.days.forEach(d => {
                        popupContent += `<b>${d.day}:</b> ${d.activity}<br>`;
                    });
                    marker.bindPopup(popupContent);
                    marker.on('click', () => {
                        // Find the first index for this location to highlight in the list
                        const firstIndex = itineraryData.findIndex(item => item.location === loc);
                        if (firstIndex !== -1) {
                            highlightItineraryItem(firstIndex);
                        }
                    });
                    markers[loc] = marker;
                }
            }

            saveBtn.addEventListener('click', () => {
                if (currentEditIndex === -1) { // Add mode
                    const newDay = newDayInput.value.trim();
                    const newLocation = newLocationInput.value.trim();
                    const newLat = parseFloat(newLatitudeInput.value);
                    const newLon = parseFloat(newLongitudeInput.value);
                    const newActivity = activityInput.value.trim();
                    const newNotes = notesInput.value.trim();

                    if (newDay && newLocation && !isNaN(newLat) && !isNaN(newLon) && newActivity) {
                        itineraryData.push({
                            day: newDay,
                            location: newLocation,
                            coords: [newLat, newLon],
                            activity: newActivity,
                            notes: newNotes
                        });
                        renderItinerary();
                        renderMap();
                        modal.style.display = 'none';
                    } else {
                        // Using a custom modal for confirmation instead of alert() or confirm()
                        const alertModal = document.createElement('div');
                        alertModal.className = 'fixed inset-0 bg-gray-600 bg-opacity-50 flex items-center justify-center z-[10000]';
                        alertModal.innerHTML = `
                            <div class="bg-white p-6 rounded-lg shadow-xl text-center">
                                <p class="text-lg font-semibold mb-4">Please fill in all required fields (Day, Location, Activity, Latitude, Longitude).</p>
                                <button id="close-alert" class="px-4 py-2 bg-blue-500 text-white rounded hover:bg-blue-600">OK</button>
                            </div>
                        `;
                        document.body.appendChild(alertModal);
                        document.getElementById('close-alert').addEventListener('click', () => {
                            document.body.removeChild(alertModal);
                        });
                    }
                } else { // Edit mode
                    itineraryData[currentEditIndex].activity = activityInput.value;
                    itineraryData[currentEditIndex].notes = notesInput.value;
                    renderItinerary();
                    renderMap();
                    modal.style.display = 'none';
                    currentEditIndex = -1;
                }
            });

            closeModalBtn.addEventListener('click', () => {
                modal.style.display = 'none';
                currentEditIndex = -1; // Reset to default
            });

            window.onclick = function(event) {
                if (event.target == modal) {
                    modal.style.display = "none";
                    currentEditIndex = -1; // Reset to default
                }
            }

            addItemBtn.addEventListener('click', openAddModal);

            renderItinerary();
            renderMap();
        });
    </script>
</body>
</html>
